import React,{useState} from 'react';
import {Stepper,Step, StepLabel, Button,Box, Typography} from '@mui/material';
import FormAdreesse from './FormAdreesse';
import FormInfosPersonnel from './FormInfosPersonnel';
import FormPaiment from './FormPaiment';

const steps = [
    'Informations Personnel',
    'Adresse de Livraison',
    'Service Paiemnt',
    'Validation'
]
export default function CommandeEtape  ()  {
            // code nalaina tao composant react de mui.com
  const [activeStep, setActiveStep] = React.useState(0); //index de l'etape actuel
  const [skipped, setSkipped] = React.useState(new Set()); // hi-stokevan ny etape nodinganina nefa tsy complet√©

  const isStepOptional = (step) => {  // declare que l'etape 1   est facultatif
    return step === 1;
  };

  const isStepSkipped = (step) => { // verifiena oe  nodinganina ve io etape (step: index d'un etape)
    return skipped.has(step);
  };

  const handleNext = () => { //aller √† l'etape suivant
    let newSkipped = skipped;
    if (isStepSkipped(activeStep)) {
      newSkipped = new Set(newSkipped.values());
      newSkipped.delete(activeStep);
    }

    setActiveStep((prevActiveStep) => prevActiveStep + 1);
    setSkipped(newSkipped);
  };

  const handleBack = () => { // revenir √† l'etape precedent
    setActiveStep((prevActiveStep) => prevActiveStep - 1);
  };

  const handleSkip = () => { // sauter une etape facultatif
    if (!isStepOptional(activeStep)) {
      throw new Error("You can't skip a step that isn't optional.");
    }
    setActiveStep((prevActiveStep) => prevActiveStep + 1);
    setSkipped((prevSkipped) => {
      const newSkipped = new Set(prevSkipped.values());
      newSkipped.add(activeStep);
      return newSkipped;
    });
  };

  const handleReset = () => { // reinitialiser l'etape
    setActiveStep(0);
  };

  const [formData, setFormData] = React.useState({
    etape1: { nom: '', email: '' },
    etape2: { adresse: '', preference: '' },
    etape3: { transactionId: '' },
  });

  

  const handleStepSubmit = (stepKey, stepData) => {
    // 1. Sauvegarder les donn√©es valid√©es dans l'√©tat centralis√©
    setFormData(prevData => ({
        ...prevData,
        [stepKey]: stepData
    }));
    // 2. Avancer le Stepper
    handleNext();
};

  function getStepContent(step) {
    let stepKey = `etape${step + 1}`;
    const commonProps = {
        initialData: formData[stepKey], 
        onSubmitSuccess: (data) => handleStepSubmit(stepKey, data),
      };
    switch (step) {
      case 0:
        return <FormInfosPersonnel {...commonProps}/>; 
      case 1:
        return <FormAdreesse />;
      case 2:
        return <FormPaiment />;
      default:
        return <Typography>√âtape Inconnue</Typography>;
    }
  }
  React.useEffect(() => {
    if (activeStep === steps.length) {
        // üö® Ici, vous d√©clenchez l'appel API final pour enregistrer la commande.
        console.log("COMMANDE COMPL√âT√âE. Donn√©es finales pour l'API :", formData);
        // Exemple : enregistrerCommandeFinale(formData);
    }
}, [activeStep, steps.length, formData]);

  return (
    <div className="flex  justify-center gap-4 h-screen py-4">
        <div className='card w-1/4'>
            <h2 className='text-xl font-semibold mb-4'>R√©sum√© de la commande</h2>
        </div>

        <Box className="w-3/4 pt-4 bg-transparent shadow-lg  rounded-xl  overflow-y-auto  overflow-x-hidden   h-screen">
            <Box className="w-full shadow-lg p-3 pb-5 rounded-xl">
              <Stepper activeStep={activeStep} orientation="vertical">
                    {steps.map((label, index) => {
                    const stepProps = {};
                    const labelProps = {};
                    
                    if (isStepSkipped(index)) {
                        stepProps.completed = false;
                    }
                    return (
                        <Step key={label} {...stepProps}>
                        <StepLabel {...labelProps}>
                            <span className={` font-gothic text-[14px] ${activeStep === index ? "font-bold dark:text-white" : "dark:text-gray-400"}`}>
                                {label}
                            </span>
                        </StepLabel>
                        </Step>
                    );
                    })}
              </Stepper>
            </Box>
            <Box className="px-6 pb-6 overflow-y-auto shadow-lg rounded-xl overflow-x-hidden [scrollbar-width:_thin] h-[calc(100vh-32px)] ">
            {activeStep === steps.length ? (
                <React.Fragment>
                <Typography className="mt-6 mb-4 font-semibold text-lg justify-center flex items-center h-[200px] text-green-600">
                    Toutes les √©tapes sont termin√©es - vous avez pass√© la commande avec succ√®s !
                </Typography>
                <Box className="flex flex-row pt-4">
                    <Box className="flex-grow" />
                    <Button onClick={handleReset} variant="outlined">
                    R√©initialiser
                    </Button>
                </Box>
                </React.Fragment>
            ) : (
                <React.Fragment>
                <Box className=" mt-6 mb-4 "> 
                    {getStepContent(activeStep)}
                </Box>
                <Box className="flex flex-row pt-4">
                    <button
                    // color="inherit"
                    disabled={activeStep === 0}
                    onClick={handleBack}
                    className={`${activeStep === 0 ? " border px-3 rounded-xl dark:border-slate-800 dark:text-gray-500 text-gray-500 bg-transparent" : "btn btn-outline bg-transparent mr-3 btn-accent"}  `}
                    
                    >
                    Pr√©c√©dent
                    </button>
                    <Box className="flex-grow" />
                    <button onClick={handleNext}  className='btn btn-accent'>
                    {activeStep === steps.length - 1 ? 'Terminer' : 'Suivant'}
                    </button>
                </Box>
                </React.Fragment>
            )}
            </Box>
        </Box>
        
    </div>
  );
}
*



***********************************


import React,{useState} from 'react';
import {Stepper,Step, StepLabel, Button,Box, Typography} from '@mui/material';
import FormAdreesse from './FormAdreesse';
import FormInfosPersonnel from './FormInfosPersonnel';
import FormPaiment from './FormPaiment';

const steps = [
    'Informations Personnel',
    'Adresse de Livraison',
    'Service Paiemnt',
    'Validation'
]

// Simulate Firebase Auth state or simply use a global context/hook if available
const useAuth = () => ({
    // Set to true if a user is logged in
    isAuthenticated: false, 
    user: { nom: '', email: '' }
});

export default function CommandeEtape () {
    const { isAuthenticated, user } = useAuth();
    
    // Si l'utilisateur est connect√©, on pourrait d√©caler l'activeStep initial ici.
    const initialStep = isAuthenticated ? 1 : 0; 

    const [activeStep, setActiveStep] = React.useState(initialStep); //index de l'etape actuel
    const [skipped, setSkipped] = React.useState(new Set()); // hi-stokevan ny etape nodinganina nefa tsy complet√©

    const isStepOptional = (step) => { ¬†// declare que l'etape 1 ¬† est facultatif
        return step === 1;
    };

    const isStepSkipped = (step) => { // verifiena oe ¬†nodinganina ve io etape (step: index d'un etape)
        return skipped.has(step);
    };

    const handleNext = () => { //aller √† l'etape suivant
        let newSkipped = skipped;
        if (isStepSkipped(activeStep)) {
            newSkipped = new Set(newSkipped.values());
            newSkipped.delete(activeStep);
        }

        setActiveStep((prevActiveStep) => prevActiveStep + 1);
        setSkipped(newSkipped);
    };

    const handleBack = () => { // revenir √† l'etape precedent
        setActiveStep((prevActiveStep) => prevActiveStep - 1);
    };

    const handleSkip = () => { // sauter une etape facultatif
        if (!isStepOptional(activeStep)) {
            throw new Error("You can't skip a step that isn't optional.");
        }
        setActiveStep((prevActiveStep) => prevActiveStep + 1);
        setSkipped((prevSkipped) => {
            const newSkipped = new Set(prevSkipped.values());
            newSkipped.add(activeStep);
            return newSkipped;
        });
    };

    const handleReset = () => { // reinitialiser l'etape
        setActiveStep(0);
    };

    // √âtat centralis√© pour les donn√©es
    const [formData, setFormData] = React.useState(() => {
        const baseData = {
            etape1: { nom: '', email: '' },
            etape2: { adresse: '', preference: '' },
            etape3: { transactionId: '' },
        };
        // Pr√©-remplir l'√©tape 1 si connect√©
        if (isAuthenticated) {
            baseData.etape1 = { nom: user.nom, email: user.email };
        }
        return baseData;
    });

    const handleStepSubmit = (stepKey, stepData) => {
        // 1. Sauvegarder les donn√©es valid√©es dans l'√©tat centralis√©
        setFormData(prevData => ({
            ...prevData,
            [stepKey]: stepData
        }));
        // 2. Avancer le Stepper
        handleNext();
    };

    function getStepContent(step) {
        let stepKey = `etape${step + 1}`;
        const commonProps = {
            initialData: formData[stepKey], 
            onSubmitSuccess: (data) => handleStepSubmit(stepKey, data),
        };
        switch (step) {
            case 0:
                return <FormInfosPersonnel {...commonProps}/>; 
            case 1:
                // Pour FormAdresse et FormPaiment, assurez-vous de passer les commonProps
                // afin qu'ils puissent g√©rer la soumission et l'avancement.
                return <FormAdreesse {...commonProps}/>;
            case 2:
                return <FormPaiment {...commonProps}/>;
            case 3:
                return <Typography>Validation Finale</Typography>;
            default:
                return <Typography>√âtape Inconnue</Typography>;
        }
    }
    
    // Logique d'enregistrement Final
    React.useEffect(() => {
        if (activeStep === steps.length) {
            console.log("COMMANDE COMPL√âT√âE. Donn√©es finales pour l'API :", formData);
        }
    }, [activeStep, steps.length, formData]);

    return (
        // La colonne de gauche (Cat√©gorie) n'est pas incluse ici car elle fait partie de la mise en page globale.
        // Nous nous concentrons sur les deux colonnes principales : Formulaire et Stepper/R√©sum√©.
        <div className="flex justify-center gap-4 h-screen py-4">
            
            {/* Colonne Principale (Formulaire) - w-2/3 (au lieu de 3/4 pour laisser plus de place au Stepper vertical) */}
            <Box className="w-2/3 pt-4 bg-white dark:bg-gray-900 shadow-lg rounded-xl overflow-y-auto overflow-x-hidden [scrollbar-width:_thin] h-[calc(100vh-32px)]">
                
                {/* Contenu du Formulaire */}
                <Box className="px-6 pb-6">
                    {activeStep === steps.length ? (
                        <React.Fragment>
                            <Typography className="mt-6 mb-4 font-semibold text-lg justify-center flex items-center h-[200px] text-green-600">
                                Toutes les √©tapes sont termin√©es - vous avez pass√© la commande avec succ√®s !
                            </Typography>
                            <Box className="flex flex-row pt-4">
                                <Box className="flex-grow" />
                                <Button onClick={handleReset} variant="outlined">
                                R√©initialiser
                                </Button>
                            </Box>
                        </React.Fragment>
                    ) : (
                        <React.Fragment>
                            <Box className="mb-4"> 
                                {/* Contenu de l'√©tape */}
                                {getStepContent(activeStep)}
                            </Box>
                            
                            {/* Les boutons de navigation (toujours affich√©s en bas du formulaire) */}
                            <Box className="flex flex-row pt-4 border-t border-gray-200 dark:border-gray-700 mt-6">
                                <button
                                    disabled={activeStep === 0}
                                    onClick={handleBack}
                                    className={`${activeStep === 0 ? " border px-3 rounded-xl dark:border-slate-800 dark:text-gray-500 text-gray-500 bg-transparent" : "btn btn-outline bg-transparent mr-3 btn-accent"} ¬†`}
                                >
                                    Pr√©c√©dent
                                </button>
                                
                                {isStepOptional(activeStep) && (
                                    <Button color="inherit" onClick={handleSkip} className="mr-3">
                                        Passer
                                    </Button>
                                )}
                                
                                <Box className="flex-grow" />
                                
                                {/* Remplacement par un bouton "Suivant" temporaire pour les √©tapes sans soumission enfant */}
                                {activeStep < steps.length - 1 && activeStep !== 0 && (
                                    <button onClick={handleNext} ¬†className='btn btn-accent'>
                                        Suivant
                                    </button>
                                )}
                                
                                {activeStep === steps.length - 1 && (
                                    <button onClick={handleNext} ¬†className='btn btn-success'>
                                        Terminer
                                    </button>
                                )}
                            </Box>
                        </React.Fragment>
                    )}
                </Box>
                
            </Box>
            
            {/* Colonne de droite (Stepper Vertical + R√©sum√© de la commande) - w-1/3 */}
            <div className='w-1/3 flex flex-col gap-4'>
                {/* üéØ Stepper VERTICAL üéØ */}
                <div className='card p-6 shadow-lg bg-white dark:bg-gray-900 rounded-xl'>
                    <h2 className='text-xl font-semibold mb-4 dark:text-white'>√âtapes de la commande</h2>
                    {/* ATTENTION : orientation="vertical" est la cl√© */}
                    <Stepper activeStep={activeStep} orientation="vertical">
                        {steps.map((label, index) => (
                            <Step key={label} completed={activeStep > index}>
                                <StepLabel>
                                    <span className={`font-gothic text-[14px] ${activeStep === index ? "font-bold dark:text-white" : "dark:text-gray-400"}`}>
                                        {label}
                                    </span>
                                </StepLabel>
                            </Step>
                        ))}
                    </Stepper>
                </div>

                {/* R√©sum√© de la commande */}
                <div className='card p-6 shadow-lg bg-white dark:bg-gray-900 rounded-xl overflow-y-auto flex-grow'>
                    <h2 className='text-xl font-semibold mb-4 dark:text-white'>R√©sum√© de la commande</h2>
                    <Typography className="dark:text-gray-400">
                        {/* Afficher les d√©tails de la commande ici */}
                        Votre panier contient 3 articles.
                    </Typography>
                </div>
            </div>
        </div>
    );
}








